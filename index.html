<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Meleze.web by meleze</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Meleze.web</h1>
        <p>Remove whitespace in ASP.NET Razor views</p>

        <p class="view"><a href="https://github.com/meleze/Meleze.Web">View the Project on GitHub <small>meleze/Meleze.Web</small></a></p>


        <ul>
          <li><a href="https://github.com/meleze/Meleze.Web/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/meleze/Meleze.Web/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/meleze/Meleze.Web">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>Meleze.Web is a plugin for ASP.NET Razor that removes all the whitespace in .cshtml views.</p>

<p>For example, a view like:</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span>Item1<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>@variable<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>

<p>is recompiled as:</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;ul&gt;&lt;li&gt;</span>Item1&gt;<span class="nt">&lt;li&gt;</span>@variable<span class="nt">&lt;/li&gt;&lt;/ul&gt;</span>
</pre></div>

<p>Meleze.Web minifies the HTML markup and also the inlined CSS and Javascript elements when System.Web.Optimization or the Microsoft Minifier DLLs are loaded in the application.</p>

<h2>
<a name="why-is-it-better-than-a-aspnet-mvc-view-filter" class="anchor" href="#why-is-it-better-than-a-aspnet-mvc-view-filter"><span class="octicon octicon-link"></span></a>Why is it better than a ASP.NET MVC view filter?</h2>

<p>With a view filter, the minification would be performed each time the view is rendered. It means the filter adds a little cost to each HTTP request.
Meleze.Web runs at COMPILE time. The views are minified only one time when Razor compiles the view. There is no minification cost when the view is rendered. It is even the opposite as the CPU has less characters to write.
When minifying at compile time, you reduce the bandwidth usage and also the used CPU (arround 15% in my web applications).</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>To use the HTML Minification for Razor, you have to change your Views/Web.config to replace the default ASP.NET MVC factory by the Meleze's one:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;system.web.webPages.razor&gt;</span>
    <span class="nt">&lt;host</span> <span class="na">factoryType=</span><span class="s">"Meleze.Web.Razor.MinifyHtmlWebRazorHostFactory, Meleze.Web, Version=1.4.0.5, Culture=neutral, PublicKeyToken=0a868b5321967eda"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/system.web.webPages.razor&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>

<p>For ASP.NET MVC 3.0, use the 1.3 version of Meleze:</p>

<div class="highlight highlight-xml"><pre>    <span class="nt">&lt;host</span> <span class="na">factoryType=</span><span class="s">"Meleze.Web.Razor.MinifyHtmlWebRazorHostFactory, Meleze.Web, Version=1.3.0.5, Culture=neutral, PublicKeyToken=0a868b5321967eda"</span> <span class="nt">/&gt;</span>
</pre></div>

<p>There are two versions of the DLL: one for ASP.NET MVC3 and another for ASP.NET MVC4. Make sure to use the correct version (it is displayed in the DLL description).</p>

<p>Making this change in the Web.config may break Intelliscense in Visual Studio if it does not find the Meleze.Web dll.</p>

<p>There are two solutions:</p>

<ol>
<li>You can setup the factory in Web.config.Release instead of the Web.config. The minification will be enabled only in release build.</li>
<li>Otherwize, you can register the Meleze.Web dll in the GAC using "gacutil.exe -i Meleze.Web". The minification will work even in design mode.</li>
</ol><p>The Minifier behavior can be configured in the application's root Web.config with some appSettings keys:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;appSettings&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"meleze-minifier:Aggressive"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"meleze-minifier:Comments"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"meleze-minifier:Javascript"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"meleze-minifier:CSS"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/appSettings&gt;</span>
</pre></div>

<p>meleze-minifier:Aggressive removes as much whitespace as possible. In some cases, you may have to change yours CSS to fix the page layout (as whitespace is not interpreted in a compatible way by all browsers).
meleze-minifier:Comments removes all the HTML comments that are neither Javascript code or conditional comments.
meleze-minifier:Javascript calls the Microsoft Ajax Minifier. The AjaxMin.dll must be in the application references for this option to work (otherwise, JS is kept as is).
meleze-minifier:CSS also calls the Microsoft Ajax Minifier to minimize the inline styles.</p>

<p>There is also a NuGet package to setup the Minifier automatically in your applications.</p>

<h2>
<a name="release-notes" class="anchor" href="#release-notes"><span class="octicon octicon-link"></span></a>Release Notes</h2>

<ul>
<li>
<p>1.4.6 and 1.3.6 (11/11/2013)</p>

<ul>
<li>Fix integration with Microsoft AjaxMin (from SoonDead)</li>
<li>Fix minification of URL starting with ~/</li>
</ul>
</li>
<li>
<p>1.4.5 and 1.3.5 (10/11/2013)</p>

<ul>
<li>Fix integration with System.Web.Optimization</li>
<li>Add minification of the Razor sections</li>
</ul>
</li>
<li>
<p>1.4.4 and 1.3.4 (30/08/2013)</p>

<ul>
<li>Fix bugs with the detection of Javascript // comments.</li>
<li>Minify the inline JS and CSS with the System.Web.Optimization if it is available.</li>
</ul>
</li>
<li>
<p>1.4.3 and 1.3.3 (4/24/2012)</p>

<ul>
<li>Fix bug when inline Javascript contains // comments and that the Javascript minifier is not enabled.</li>
<li>Minify the inline CSS with the Microsoft Ajax Minifier (like for the inline Javascript).</li>
</ul>
</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/meleze">meleze</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-22166712-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>